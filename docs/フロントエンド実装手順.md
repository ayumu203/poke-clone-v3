# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…æ‰‹é †æ›¸

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIä»•æ§˜](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰apiä»•æ§˜)
3. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰è©³ç´°](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰è©³ç´°)
4. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—)
5. [SignalRï¼ˆWebSocketï¼‰ã«ã‚ˆã‚‹å¯¾æˆ¦ãƒ•ãƒ­ãƒ¼](#signalrwebsocketã«ã‚ˆã‚‹å¯¾æˆ¦ãƒ•ãƒ­ãƒ¼)
6. [çŠ¶æ…‹ç®¡ç†ã®è¨­è¨ˆ](#çŠ¶æ…‹ç®¡ç†ã®è¨­è¨ˆ)
7. [UI/UXã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰](#uiuxã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰)

---

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒã‚±ãƒ¢ãƒ³ã‚¯ãƒ­ãƒ¼ãƒ³ã‚²ãƒ¼ãƒ ã®ãƒãƒˆãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å®Ÿè£…ã™ã‚‹ãŸã‚ã®æ‰‹é †æ›¸ã§ã™ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®APIã¨SignalRã‚’æ´»ç”¨ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯¾æˆ¦æ©Ÿèƒ½ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React/Next.js  â”‚  HTTP   â”‚   ASP.NET Core   â”‚  Redis  â”‚   Redis     â”‚
â”‚   ãƒ•ãƒ­ãƒ³ãƒˆ      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   WebAPI         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Cache     â”‚
â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   + SignalR Hub  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ SignalR â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  SQL Server DB   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIä»•æ§˜

### èªè¨¼API

#### POST `/api/Auth/login/mock`

**ç”¨é€”**: é–‹ç™ºç”¨ãƒ¢ãƒƒã‚¯èªè¨¼ï¼ˆæœ¬ç•ªã§ã¯å®Ÿè£…ãŒå¿…è¦ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "username": "testplayer1",
  "password": "testpassword"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "message": "Login successful",
  "username": "testplayer1",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**ä½¿ç”¨æ–¹æ³•**:
1. JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
2. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
3. ä»¥é™ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§`Authorization: Bearer {token}`ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»˜ä¸

---

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼API

#### GET `/api/Player/{playerId}`

**ç”¨é€”**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã¨ãƒ‘ãƒ¼ãƒ†ã‚£ã®å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "playerId": "player1",
  "name": "ã‚µãƒˆã‚·",
  "iconUrl": "https://example.com/icon.png",
  "party": [
    {
      "pokemonId": "poke001",
      "nickname": "ãƒ”ã‚«ãƒãƒ¥ã‚¦",
      "level": 25,
      "species": {
        "pokemonSpeciesId": 25,
        "name": "ãƒ”ã‚«ãƒãƒ¥ã‚¦",
        "frontImage": "/images/pikachu_front.png",
        "backImage": "/images/pikachu_back.png",
        "type1": "Electric",
        "type2": null,
        "baseHp": 35,
        "baseAttack": 55,
        "baseDefence": 40,
        "baseSpecialAttack": 50,
        "baseSpecialDefence": 50,
        "baseSpeed": 90
      },
      "moveList": [
        {
          "moveId": 1,
          "name": "ã§ã‚“ãã‚·ãƒ§ãƒƒã‚¯",
          "type": "Electric",
          "damageClass": "Special",
          "power": 40,
          "accuracy": 100,
          "pp": 30
        }
      ]
    }
  ]
}
```

---

### ãƒãƒˆãƒ«API

#### POST `/api/Battle/create`

**ç”¨é€”**: å¯¾äººãƒãƒˆãƒ«ã®ä½œæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "player1Id": "player1",
  "player2Id": "player2"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "battleId": "battle-uuid-1234",
  "player1": {
    "playerId": "player1",
    "player": { /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ± */ },
    "activePokemonIndex": 0,
    "party": [
      {
        "pokemonId": "poke001",
        "pokemonSpeciesId": 25,
        "currentHp": 95,
        "maxHp": 95,
        "ailment": "None",
        "rank": {
          "attack": 0,
          "defence": 0,
          "specialAttack": 0,
          "specialDefence": 0,
          "speed": 0,
          "accuracy": 0,
          "evasion": 0
        }
      }
    ]
  },
  "player2": { /* åŒæ§˜ã®æ§‹é€  */ },
  "turn": 0,
  "createdAt": "2025-11-30T10:00:00Z",
  "expireAt": "2025-11-30T11:00:00Z"
}
```

#### POST `/api/Battle/cpu`

**ç”¨é€”**: CPUãƒãƒˆãƒ«ã®ä½œæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "playerId": "player1"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `/api/Battle/create`ã¨åŒæ§˜

#### GET `/api/Battle/{battleId}`

**ç”¨é€”**: ç¾åœ¨ã®ãƒãƒˆãƒ«çŠ¶æ…‹ã‚’å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `/api/Battle/create`ã¨åŒæ§˜

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰è©³ç´°

### 1. BattleHub (SignalR Hub)

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `Server.WebAPI/Hubs/BattleHub.cs`

#### é‡è¦ãƒ¡ã‚½ãƒƒãƒ‰

##### `InitBattle(string battleId)`

**ç›®çš„**: ãƒãƒˆãƒ«ãƒ«ãƒ¼ãƒ ã¸ã®æ¥ç¶š

**å‹•ä½œ**:
1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æŒ‡å®šã•ã‚ŒãŸãƒãƒˆãƒ«IDã®ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
2. ãƒãƒˆãƒ«çŠ¶æ…‹ã‚’Redisã‹ã‚‰å–å¾—ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…**:
```typescript
// SignalRæ¥ç¶šç¢ºç«‹å¾Œã«å‘¼ã³å‡ºã™
await connection.invoke("InitBattle", battleId);
```

##### `SubmitAction(string battleId, PlayerAction action)`

**ç›®çš„**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡

**PlayerActionæ§‹é€ **:
```csharp
public class PlayerAction
{
    public string PlayerId { get; set; }
    public ActionType ActionType { get; set; }  // Attack, Switch, Catch
    public int? MoveId { get; set; }            // æŠ€IDï¼ˆæ”»æ’ƒæ™‚ï¼‰
    public int? SwitchPokemonIndex { get; set; } // äº¤ä»£å…ˆï¼ˆäº¤ä»£æ™‚ï¼‰
}
```

**ActionTypeåˆ—æŒ™å‹**:
- `Attack`: æŠ€ã‚’ä½¿ç”¨
- `Switch`: ãƒã‚±ãƒ¢ãƒ³ã‚’äº¤ä»£
- `Catch`: é‡ç”Ÿãƒã‚±ãƒ¢ãƒ³ã‚’æ•ç²ï¼ˆCPUãƒãƒˆãƒ«æ™‚ã®ã¿ï¼‰

**å‹•ä½œ**:
1. ä¸¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæƒã†ã¾ã§å¾…æ©Ÿ
2. æƒã£ãŸã‚‰`ProcessTurnAsync()`ã‚’å‘¼ã³å‡ºã—
3. ã‚¿ãƒ¼ãƒ³çµæœã‚’`ReceiveTurnResult`ã§å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é…ä¿¡

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…**:
```typescript
// æ”»æ’ƒã‚¢ã‚¯ã‚·ãƒ§ãƒ³
const attackAction = {
  playerId: "player1",
  actionType: 0, // Attack
  moveId: 1,
  switchPokemonIndex: null
};

await connection.invoke("SubmitAction", battleId, attackAction);

// äº¤ä»£ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
const switchAction = {
  playerId: "player1",
  actionType: 1, // Switch
  moveId: null,
  switchPokemonIndex: 2  // 3ç•ªç›®ã®ãƒã‚±ãƒ¢ãƒ³ã«äº¤ä»£
};

await connection.invoke("SubmitAction", battleId, switchAction);
```

##### `ReceiveTurnResult` (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå—ä¿¡)

**ç›®çš„**: ã‚¿ãƒ¼ãƒ³å‡¦ç†çµæœã®å—ä¿¡

**ProcessResultæ§‹é€ **:
```typescript
interface ProcessResult {
  actionResults: ActionResult[];
  isBattleEnd: boolean;
  winnerId: string;
}

interface ActionResult {
  actionPokemonId: string;
  actionType: number;  // 0: Attack, 1: Switch, 2: Catch
  moveResult?: MoveResult;
  switchResult?: SwitchResult;
  catchResult?: CatchResult;
}

interface MoveResult {
  moveId: number;
  targetId: string;
  isSuccess: boolean;
  failureReason: string;
  damage: number;
  hitContext?: {
    isCritical: boolean;
    typeEffectiveness: number;  // 0.25, 0.5, 1.0, 2.0, 4.0
  };
  sourceRankChange?: Rank;
  targetRankChange?: Rank;
  ailment?: string;  // "None", "Paralysis", "Sleep", etc.
}
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…**:
```typescript
connection.on("ReceiveTurnResult", (result: ProcessResult) => {
  // ã‚¿ãƒ¼ãƒ³çµæœã‚’å‡¦ç†
  result.actionResults.forEach(action => {
    if (action.moveResult) {
      // ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
      displayDamage(action.moveResult.damage);
      
      // HPæ›´æ–°
      updatePokemonHp(action.moveResult.targetId, action.moveResult.damage);
      
      // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¡¨ç¤º
      if (action.moveResult.hitContext?.isCritical) {
        showCriticalEffect();
      }
    }
  });
  
  // ãƒãƒˆãƒ«çµ‚äº†åˆ¤å®š
  if (result.isBattleEnd) {
    showBattleResult(result.winnerId);
  }
});
```

---

### 2. BattleService

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `Server.Application/Services/BattleService.cs`

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

##### `CreateBattleAsync(string player1Id, string player2Id)`

**ç›®çš„**: å¯¾äººãƒãƒˆãƒ«ã®åˆæœŸåŒ–

**å‡¦ç†å†…å®¹**:
1. ä¸¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’DBã‹ã‚‰å–å¾—
2. `PlayerState`ã‚’ä½œæˆï¼ˆå„ãƒã‚±ãƒ¢ãƒ³ã®HPã‚’æœ€å¤§å€¤ã§åˆæœŸåŒ–ï¼‰
3. `BattleState`ã‚’ä½œæˆã—ã¦Redisã«ä¿å­˜
4. ãƒãƒˆãƒ«IDã‚’ç”Ÿæˆã—ã¦è¿”å´

##### `CreateCpuBattleAsync(string playerId)`

**ç›®çš„**: CPUãƒãƒˆãƒ«ã®åˆæœŸåŒ–

**å‡¦ç†å†…å®¹**:
1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’DBã‹ã‚‰å–å¾—
2. CPUãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆï¼ˆç°¡æ˜“å®Ÿè£…ã€æ‹¡å¼µå¯èƒ½ï¼‰
3. ãƒãƒˆãƒ«çŠ¶æ…‹ã‚’åˆæœŸåŒ–ã—ã¦Redisã«ä¿å­˜

##### `ProcessTurnAsync(string battleId, PlayerAction action1, PlayerAction action2)`

**ç›®çš„**: 1ã‚¿ãƒ¼ãƒ³ã®å‡¦ç†å®Ÿè¡Œ

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
```
1. Redisã§åˆ†æ•£ãƒ­ãƒƒã‚¯å–å¾—ï¼ˆåŒæ™‚å®Ÿè¡Œé˜²æ­¢ï¼‰
   â†“
2. BattleStateã‚’Redisã‹ã‚‰å–å¾—
   â†“
3. Battleãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
   â†“
4. Battle.ProcessTurn(action1, action2)ã‚’å®Ÿè¡Œ
   â”œâ”€ ç´ æ—©ã•åˆ¤å®šã§è¡Œå‹•é †æ±ºå®š
   â”œâ”€ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³1å®Ÿè¡Œ
   â”‚  â”œâ”€ æ”»æ’ƒ: ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ã€å‘½ä¸­åˆ¤å®šã€ã‚¿ã‚¤ãƒ—ç›¸æ€§
   â”‚  â”œâ”€ äº¤ä»£: ãƒã‚±ãƒ¢ãƒ³äº¤ä»£å‡¦ç†
   â”‚  â””â”€ æ•ç²: æ•ç²åˆ¤å®š
   â””â”€ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³2å®Ÿè¡Œï¼ˆåŒæ§˜ï¼‰
   â†“
5. ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’PlayerState.Party[].CurrentHpã«åæ˜ 
   â†“
6. å…¨ãƒã‚±ãƒ¢ãƒ³ç€•æ­»åˆ¤å®šï¼ˆIsBattleEnd, WinnerIdè¨­å®šï¼‰
   â†“
7. ã‚¿ãƒ¼ãƒ³æ•°ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
   â†“
8. æ›´æ–°ã•ã‚ŒãŸBattleStateã‚’Redisã«ä¿å­˜
   â†“
9. ProcessResultã‚’è¿”å´
   â†“
10. Redisãƒ­ãƒƒã‚¯è§£æ”¾
```

---

### 3. Battle (ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«)

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `Server.Domain/Battle.cs`

#### ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

```csharp
public Battle(
    IDamageCalculator damageCalculator,
    ITypeEffectivenessManager typeEffectivenessManager,
    IStatCalculator statCalculator,
    BattlePlayer player1,
    BattlePlayer player2)
```

#### `ProcessTurn(PlayerAction action1, PlayerAction action2)`

**ç›®çš„**: ã‚¿ãƒ¼ãƒ³å‡¦ç†ã®ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯

**å‡¦ç†è©³ç´°**:

1. **è¡Œå‹•é †æ±ºå®š**:
   - å„ªå…ˆåº¦: äº¤ä»£ > æ”»æ’ƒ
   - åŒå„ªå…ˆåº¦ã®å ´åˆ: ç´ æ—©ã•ã®é«˜ã„æ–¹ãŒå…ˆè¡Œ
   - ç´ æ—©ã•åŒå€¤: ãƒ©ãƒ³ãƒ€ãƒ 

2. **æ”»æ’ƒå‡¦ç†** (`ProcessMoveAction`):
   ```
   â‘  å‘½ä¸­åˆ¤å®šï¼ˆAccuracy: 1-100ã®ä¹±æ•°ï¼‰
   â‘¡ ã‚¿ã‚¤ãƒ—ç›¸æ€§è¨ˆç®—ï¼ˆ0.25å€ï½4å€ï¼‰
   â‘¢ ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å¼:
      damage = ((level Ã— 2 Ã· 5 + 2) Ã— power Ã— attack Ã· defence Ã· 50 + 2)
               Ã— random(85-100) Ã· 100
               Ã— typeEffectiveness
               Ã— (critical ? 1.5 : 1.0)
   â‘£ æ€¥æ‰€åˆ¤å®šï¼ˆ1/16ã®ç¢ºç‡ï¼‰
   â‘¤ ãƒ©ãƒ³ã‚¯è£œæ­£è¨ˆç®—
   â‘¥ MoveResultç”Ÿæˆ
   ```

3. **äº¤ä»£å‡¦ç†** (`ProcessSwitchAction`):
   ```
   â‘  äº¤ä»£å…ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å¦¥å½“æ€§ç¢ºèª
   â‘¡ ActivePokemonIndexã‚’æ›´æ–°
   â‘¢ SwitchResultç”Ÿæˆ
   ```

4. **æ•ç²å‡¦ç†** (`ProcessCatchAction`):
   ```
   â‘  æ•ç²ç‡è¨ˆç®—ï¼ˆHPä¾å­˜ï¼‰
   â‘¡ ãƒ©ãƒ³ãƒ€ãƒ åˆ¤å®š
   â‘¢ æˆåŠŸæ™‚ã¯å¯¾è±¡ãƒã‚±ãƒ¢ãƒ³ã‚’Player1ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã«è¿½åŠ 
   â‘£ CatchResultç”Ÿæˆ
   ```

---

### 4. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹

#### BattleState

**æ§‹é€ **:
```csharp
public class BattleState
{
    public string BattleId { get; set; }
    public PlayerState Player1 { get; set; }
    public PlayerState Player2 { get; set; }
    public int Turn { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime? ExpireAt { get; set; }
}
```

**Redisä¿å­˜**: JSONå½¢å¼ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¦ä¿å­˜

#### PlayerState

**æ§‹é€ **:
```csharp
public class PlayerState
{
    public string PlayerId { get; set; }
    public Player Player { get; set; }
    public int ActivePokemonIndex { get; set; }
    public List<PokemonState> Party { get; set; }
    public List<Pokemon> PokemonEntities { get; set; }  // Battleè¨ˆç®—ç”¨
    public PlayerAction? Action { get; set; }
    
    // ä¾¿åˆ©ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    public bool AllPokemonFainted => Party.All(p => p.IsFainted);
    public PokemonState ActivePokemon => Party[ActivePokemonIndex];
}
```

#### PokemonState

**æ§‹é€ **:
```csharp
public class PokemonState
{
    public string PokemonId { get; set; }
    public int PokemonSpeciesId { get; set; }
    public int CurrentHp { get; set; }
    public int MaxHp { get; set; }
    public Ailment Ailment { get; set; }  // None, Paralysis, Sleep, etc.
    public Rank Rank { get; set; }
    
    // ä¾¿åˆ©ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    public bool IsFainted => CurrentHp <= 0;
}
```

**é‡è¦**: `CurrentHp`ãŒãƒãƒˆãƒ«ä¸­ã®ç¾åœ¨HPã‚’è¡¨ã—ã€ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã‚‹ãŸã³ã«æ¸›å°‘ã—ã¾ã™ã€‚

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Step 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª

```bash
# Next.jsï¼ˆæ¨å¥¨ï¼‰
npx create-next-app@latest poke-clone-frontend --typescript

# ã¾ãŸã¯ React
npx create-react-app poke-clone-frontend --template typescript

# SignalR ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
npm install @microsoft/signalr

# çŠ¶æ…‹ç®¡ç†ï¼ˆZustandæ¨å¥¨ï¼‰
npm install zustand

# APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
npm install axios

# ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
npm install tailwindcss @tailwindcss/forms

# Storybook ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
npx storybook@latest init

# ã¾ãŸã¯æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install --save-dev @storybook/react @storybook/addon-essentials @storybook/addon-interactions @storybook/addon-links @storybook/blocks @storybook/test
```

#### Storybookã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Storybookã¯ã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã—ãŸç’°å¢ƒã§é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

##### 1. Storybookã®åˆæœŸåŒ–

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
npx storybook@latest init
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯è‡ªå‹•çš„ã«ä»¥ä¸‹ã‚’è¡Œã„ã¾ã™:
- å¿…è¦ãªä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- `.storybook/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
- ã‚µãƒ³ãƒ—ãƒ«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®ç”Ÿæˆ
- `package.json` ã¸ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ 

##### 2. Storybookã®è¨­å®š

**`.storybook/main.js`** (ã¾ãŸã¯ `.ts`):

```javascript
module.exports = {
  stories: ['../src/**/*.stories.@(js|jsx|ts|tsx)'],
  addons: [
    '@storybook/addon-essentials',
    '@storybook/addon-interactions',
    '@storybook/addon-links',
  ],
  framework: {
    name: '@storybook/react-vite', // ã¾ãŸã¯ '@storybook/react-webpack5'
    options: {},
  },
  docs: {
    autodocs: 'tag',
  },
};
```

**`.storybook/preview.js`**:

```javascript
import '../src/index.css'; // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

export const parameters = {
  actions: { argTypesRegex: '^on[A-Z].*' },
  controls: {
    matchers: {
      color: /(background|color)$/i,
      date: /Date$/,
    },
  },
};
```

##### 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®ä½œæˆä¾‹

**`src/components/Battle/HPBar.stories.tsx`**:

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { HPBar } from './HPBar';

const meta: Meta<typeof HPBar> = {
  title: 'Battle/HPBar',
  component: HPBar,
  tags: ['autodocs'],
  argTypes: {
    currentHp: { control: { type: 'number', min: 0, max: 100 } },
    maxHp: { control: { type: 'number', min: 1, max: 100 } },
  },
};

export default meta;
type Story = StoryObj<typeof HPBar>;

export const Full: Story = {
  args: {
    currentHp: 100,
    maxHp: 100,
  },
};

export const Half: Story = {
  args: {
    currentHp: 50,
    maxHp: 100,
  },
};

export const Low: Story = {
  args: {
    currentHp: 15,
    maxHp: 100,
  },
};

export const Critical: Story = {
  args: {
    currentHp: 5,
    maxHp: 100,
  },
};
```

**`src/components/Battle/PokemonDisplay.stories.tsx`**:

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { PokemonDisplay } from './PokemonDisplay';

const meta: Meta<typeof PokemonDisplay> = {
  title: 'Battle/PokemonDisplay',
  component: PokemonDisplay,
  tags: ['autodocs'],
};

export default meta;
type Story = StoryObj<typeof PokemonDisplay>;

export const Pikachu: Story = {
  args: {
    pokemon: {
      pokemonId: 'poke001',
      pokemonSpeciesId: 25,
      currentHp: 95,
      maxHp: 95,
      ailment: 'None',
      rank: {
        attack: 0,
        defence: 0,
        specialAttack: 0,
        specialDefence: 0,
        speed: 0,
        accuracy: 0,
        evasion: 0,
      },
    },
    species: {
      pokemonSpeciesId: 25,
      name: 'ãƒ”ã‚«ãƒãƒ¥ã‚¦',
      frontImage: '/images/pikachu_front.png',
      backImage: '/images/pikachu_back.png',
      type1: 'Electric',
      type2: null,
      baseHp: 35,
      baseAttack: 55,
      baseDefence: 40,
      baseSpecialAttack: 50,
      baseSpecialDefence: 50,
      baseSpeed: 90,
    },
    isPlayer: true,
  },
};

export const OpponentCharizard: Story = {
  args: {
    pokemon: {
      pokemonId: 'poke002',
      pokemonSpeciesId: 6,
      currentHp: 78,
      maxHp: 78,
      ailment: 'None',
      rank: {
        attack: 0,
        defence: 0,
        specialAttack: 0,
        specialDefence: 0,
        speed: 0,
        accuracy: 0,
        evasion: 0,
      },
    },
    species: {
      pokemonSpeciesId: 6,
      name: 'ãƒªã‚¶ãƒ¼ãƒ‰ãƒ³',
      frontImage: '/images/charizard_front.png',
      backImage: '/images/charizard_back.png',
      type1: 'Fire',
      type2: 'Flying',
      baseHp: 78,
      baseAttack: 84,
      baseDefence: 78,
      baseSpecialAttack: 109,
      baseSpecialDefence: 85,
      baseSpeed: 100,
    },
    isPlayer: false,
  },
};
```

##### 4. Storybookã®èµ·å‹•

```bash
# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
npm run storybook

# ãƒ“ãƒ«ãƒ‰ï¼ˆé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼‰
npm run build-storybook
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `http://localhost:6006` ã§StorybookãŒèµ·å‹•ã—ã¾ã™ã€‚

##### 5. ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä½œæˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã”ã¨ã«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä½œæˆ**: å„UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹ `.stories.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
- **è¤‡æ•°ã®çŠ¶æ…‹ã‚’è¡¨ç¾**: æ­£å¸¸çŠ¶æ…‹ã€ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãªã©ã€æ§˜ã€…ãªçŠ¶æ…‹ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç”¨æ„
- **Argsã‚’æ´»ç”¨**: `args` ã‚’ä½¿ã£ã¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‹•çš„ã«å¤‰æ›´å¯èƒ½ã«ã™ã‚‹
- **Actionsã‚’ä½¿ç”¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¯ãƒªãƒƒã‚¯ã€å…¥åŠ›ãªã©ï¼‰ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
- **Autodocsã‚’æœ‰åŠ¹åŒ–**: `tags: ['autodocs']` ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ

---

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ï¼ˆStorybookè¿½åŠ å¾Œï¼‰

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Battle/
â”‚   â”‚   â”œâ”€â”€ BattleField.tsx
â”‚   â”‚   â”œâ”€â”€ BattleField.stories.tsx      # è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ PokemonDisplay.tsx
â”‚   â”‚   â”œâ”€â”€ PokemonDisplay.stories.tsx   # è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ HPBar.tsx
â”‚   â”‚   â”œâ”€â”€ HPBar.stories.tsx            # è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ MoveSelector.tsx
â”‚   â”‚   â”œâ”€â”€ MoveSelector.stories.tsx     # è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ PokemonSelector.tsx
â”‚   â”‚   â”œâ”€â”€ PokemonSelector.stories.tsx  # è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ BattleLog.tsx
â”‚   â”‚   â”œâ”€â”€ BattleLog.stories.tsx        # è¿½åŠ 
â”‚   â”‚   â””â”€â”€ TypeEffectivenessIcon.tsx
â”‚   â”‚       â””â”€â”€ TypeEffectivenessIcon.stories.tsx  # è¿½åŠ 
â”‚   â””â”€â”€ Auth/
â”‚       â”œâ”€â”€ Login.tsx
â”‚       â””â”€â”€ Login.stories.tsx            # è¿½åŠ 
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useBattle.ts
â”‚   â”œâ”€â”€ useSignalR.ts
â”‚   â””â”€â”€ useAuth.ts
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api.ts
â”‚   â””â”€â”€ signalr.ts
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ battleStore.ts
â”‚   â””â”€â”€ authStore.ts
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ battle.ts
â”‚   â”œâ”€â”€ pokemon.ts
â”‚   â””â”€â”€ action.ts
â””â”€â”€ utils/
    â”œâ”€â”€ typeEffectiveness.ts
    â””â”€â”€ damageCalculator.ts

.storybook/                              # è¿½åŠ 
â”œâ”€â”€ main.js                              # Storybookè¨­å®š
â””â”€â”€ preview.js                           # ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šãƒ»ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼
```





---

### Step 2: å‹å®šç¾©

**`types/battle.ts`**:

```typescript
export interface BattleState {
  battleId: string;
  player1: PlayerState;
  player2: PlayerState;
  turn: number;
  createdAt: string;
  expireAt?: string;
}

export interface PlayerState {
  playerId: string;
  player: Player;
  activePokemonIndex: number;
  party: PokemonState[];
  action?: PlayerAction;
}

export interface PokemonState {
  pokemonId: string;
  pokemonSpeciesId: number;
  currentHp: number;
  maxHp: number;
  ailment: Ailment;
  rank: Rank;
  isFainted?: boolean;
}

export interface Player {
  playerId: string;
  name: string;
  iconUrl?: string;
}

export interface Rank {
  attack: number;
  defence: number;
  specialAttack: number;
  specialDefence: number;
  speed: number;
  accuracy: number;
  evasion: number;
}

export type Ailment = 
  | 'None' 
  | 'Paralysis' 
  | 'Sleep' 
  | 'Freeze' 
  | 'Burn' 
  | 'Poison' 
  | 'DeadlyPoisoned';

export interface PlayerAction {
  playerId: string;
  actionType: ActionType;
  moveId?: number;
  switchPokemonIndex?: number;
}

export enum ActionType {
  Attack = 0,
  Switch = 1,
  Catch = 2
}

export interface ProcessResult {
  actionResults: ActionResult[];
  isBattleEnd: boolean;
  winnerId: string;
}

export interface ActionResult {
  actionPokemonId: string;
  actionType: ActionType;
  moveResult?: MoveResult;
  switchResult?: SwitchResult;
  catchResult?: CatchResult;
}

export interface MoveResult {
  moveId: number;
  targetId: string;
  isSuccess: boolean;
  failureReason: string;
  damage: number;
  hitContext?: {
    isCritical: boolean;
    typeEffectiveness: number;
  };
  sourceRankChange?: Rank;
  targetRankChange?: Rank;
  ailment?: string;
}

export interface SwitchResult {
  currentPokemonId: string;
  nextPokemonId: string;
}

export interface CatchResult {
  isSuccess: boolean;
  caughtPokemonId: string;
}
```

---

### Step 3: SignalRæ¥ç¶šç®¡ç†

**`services/signalr.ts`**:

```typescript
import * as signalR from '@microsoft/signalr';

class SignalRService {
  private connection: signalR.HubConnection | null = null;
  
  async connect(token: string): Promise<signalR.HubConnection> {
    if (this.connection) {
      return this.connection;
    }
    
    this.connection = new signalR.HubConnectionBuilder()
      .withUrl('http://localhost:5000/hubs/battle', {
        accessTokenFactory: () => token,
        transport: signalR.HttpTransportType.WebSockets
      })
      .withAutomaticReconnect()
      .configureLogging(signalR.LogLevel.Information)
      .build();
    
    await this.connection.start();
    console.log('SignalR Connected');
    
    return this.connection;
  }
  
  async disconnect(): Promise<void> {
    if (this.connection) {
      await this.connection.stop();
      this.connection = null;
      console.log('SignalR Disconnected');
    }
  }
  
  getConnection(): signalR.HubConnection | null {
    return this.connection;
  }
}

export const signalRService = new SignalRService();
```

---

### Step 4: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

**`hooks/useSignalR.ts`**:

```typescript
import { useEffect, useState } from 'react';
import { signalRService } from '@/services/signalr';
import { ProcessResult } from '@/types/battle';
import * as signalR from '@microsoft/signalr';

export const useSignalR = (
  battleId: string,
  token: string,
  onTurnResult: (result: ProcessResult) => void
) => {
  const [connection, setConnection] = useState<signalR.HubConnection | null>(null);
  const [isConnected, setIsConnected] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  useEffect(() => {
    const setupConnection = async () => {
      try {
        const conn = await signalRService.connect(token);
        
        // ã‚¿ãƒ¼ãƒ³çµæœå—ä¿¡ãƒãƒ³ãƒ‰ãƒ©
        conn.on('ReceiveTurnResult', (result: ProcessResult) => {
          console.log('Turn result received:', result);
          onTurnResult(result);
        });
        
        // ãƒãƒˆãƒ«çŠ¶æ…‹å—ä¿¡ãƒãƒ³ãƒ‰ãƒ©
        conn.on('ReceiveBattleState', (state: any) => {
          console.log('Battle state received:', state);
        });
        
        // ãƒãƒˆãƒ«åˆæœŸåŒ–
        await conn.invoke('InitBattle', battleId);
        
        setConnection(conn);
        setIsConnected(true);
      } catch (err) {
        console.error('SignalR connection error:', err);
        setError(err instanceof Error ? err.message : 'Unknown error');
      }
    };
    
    setupConnection();
    
    return () => {
      signalRService.disconnect();
    };
  }, [battleId, token]);
  
  const submitAction = async (action: PlayerAction) => {
    if (!connection) {
      throw new Error('SignalR not connected');
    }
    
    try {
      await connection.invoke('SubmitAction', battleId, action);
    } catch (err) {
      console.error('Failed to submit action:', err);
      throw err;
    }
  };
  
  return { connection, isConnected, error, submitAction };
};
```

---

### Step 5: ãƒãƒˆãƒ«çŠ¶æ…‹ç®¡ç†

**`stores/battleStore.ts`** (Zustandä½¿ç”¨):

```typescript
import { create } from 'zustand';
import { BattleState, ProcessResult, PokemonState } from '@/types/battle';

interface BattleStore {
  battleState: BattleState | null;
  turnResult: ProcessResult | null;
  battleLog: string[];
  isWaitingForOpponent: boolean;
  
  setBattleState: (state: BattleState) => void;
  setTurnResult: (result: ProcessResult) => void;
  addLog: (message: string) => void;
  clearLog: () => void;
  updatePokemonHp: (pokemonId: string, damage: number) => void;
  setWaitingForOpponent: (waiting: boolean) => void;
  resetBattle: () => void;
}

export const useBattleStore = create<BattleStore>((set) => ({
  battleState: null,
  turnResult: null,
  battleLog: [],
  isWaitingForOpponent: false,
  
  setBattleState: (state) => set({ battleState: state }),
  
  setTurnResult: (result) => set({ turnResult: result }),
  
  addLog: (message) => set((state) => ({
    battleLog: [...state.battleLog, message]
  })),
  
  clearLog: () => set({ battleLog: [] }),
  
  updatePokemonHp: (pokemonId, damage) => set((state) => {
    if (!state.battleState) return state;
    
    const updateParty = (party: PokemonState[]) =>
      party.map(p => 
        p.pokemonId === pokemonId
          ? { ...p, currentHp: Math.max(0, p.currentHp - damage) }
          : p
      );
    
    return {
      battleState: {
        ...state.battleState,
        player1: {
          ...state.battleState.player1,
          party: updateParty(state.battleState.player1.party)
        },
        player2: {
          ...state.battleState.player2,
          party: updateParty(state.battleState.player2.party)
        }
      }
    };
  }),
  
  setWaitingForOpponent: (waiting) => set({ isWaitingForOpponent: waiting }),
  
  resetBattle: () => set({
    battleState: null,
    turnResult: null,
    battleLog: [],
    isWaitingForOpponent: false
  })
}));
```

---

### Step 6: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

#### BattleField.tsx

```typescript
import React, { useEffect, useState } from 'react';
import { useSignalR } from '@/hooks/useSignalR';
import { useBattleStore } from '@/stores/battleStore';
import { PokemonDisplay } from './PokemonDisplay';
import { HPBar } from './HPBar';
import { MoveSelector } from './MoveSelector';
import { BattleLog } from './BattleLog';
import { ActionType, PlayerAction } from '@/types/battle';

interface BattleFieldProps {
  battleId: string;
  playerId: string;
  token: string;
}

export const BattleField: React.FC<BattleFieldProps> = ({
  battleId,
  playerId,
  token
}) => {
  const { battleState, turnResult, addLog, updatePokemonHp, setWaitingForOpponent } = useBattleStore();
  const [selectedMove, setSelectedMove] = useState<number | null>(null);
  
  const handleTurnResult = (result: ProcessResult) => {
    // ãƒ­ã‚°è¿½åŠ 
    result.actionResults.forEach(action => {
      if (action.moveResult) {
        const move = action.moveResult;
        addLog(`${move.damage}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
        
        if (move.hitContext?.isCritical) {
          addLog('æ€¥æ‰€ã«å½“ãŸã£ãŸï¼');
        }
        
        if (move.hitContext?.typeEffectiveness > 1) {
          addLog('åŠ¹æœã¯æŠœç¾¤ã ï¼');
        } else if (move.hitContext?.typeEffectiveness < 1) {
          addLog('åŠ¹æœã¯ã„ã¾ã²ã¨ã¤ã®ã‚ˆã†ã ...');
        }
        
        // HPæ›´æ–°
        updatePokemonHp(move.targetId, move.damage);
      }
    });
    
    // ãƒãƒˆãƒ«çµ‚äº†åˆ¤å®š
    if (result.isBattleEnd) {
      const isWinner = result.winnerId === playerId;
      addLog(isWinner ? 'ã‚ãªãŸã®å‹ã¡ã§ã™ï¼' : 'ã‚ãªãŸã®è² ã‘ã§ã™...');
    }
    
    setWaitingForOpponent(false);
  };
  
  const { isConnected, submitAction } = useSignalR(
    battleId,
    token,
    handleTurnResult
  );
  
  const handleMoveSelect = async (moveId: number) => {
    const action: PlayerAction = {
      playerId,
      actionType: ActionType.Attack,
      moveId
    };
    
    await submitAction(action);
    setWaitingForOpponent(true);
    addLog('ç›¸æ‰‹ã®è¡Œå‹•ã‚’å¾…ã£ã¦ã„ã¾ã™...');
  };
  
  if (!isConnected || !battleState) {
    return <div>æ¥ç¶šä¸­...</div>;
  }
  
  const isMyTurn = battleState.player1.playerId === playerId;
  const myState = isMyTurn ? battleState.player1 : battleState.player2;
  const opponentState = isMyTurn ? battleState.player2 : battleState.player1;
  
  const myPokemon = myState.party[myState.activePokemonIndex];
  const opponentPokemon = opponentState.party[opponentState.activePokemonIndex];
  
  return (
    <div className="battle-field">
      {/* ç›¸æ‰‹ã®ãƒã‚±ãƒ¢ãƒ³ */}
      <div className="opponent-area">
        <PokemonDisplay
          pokemon={opponentPokemon}
          isOpponent={true}
        />
        <HPBar
          current={opponentPokemon.currentHp}
          max={opponentPokemon.maxHp}
        />
      </div>
      
      {/* è‡ªåˆ†ã®ãƒã‚±ãƒ¢ãƒ³ */}
      <div className="player-area">
        <PokemonDisplay
          pokemon={myPokemon}
          isOpponent={false}
        />
        <HPBar
          current={myPokemon.currentHp}
          max={myPokemon.maxHp}
          showNumbers={true}
        />
      </div>
      
      {/* ã‚³ãƒãƒ³ãƒ‰é¸æŠ */}
      <div className="command-area">
        <MoveSelector
          moves={myPokemon.moves}
          onMoveSelect={handleMoveSelect}
          disabled={isWaitingForOpponent}
        />
      </div>
      
      {/* ãƒãƒˆãƒ«ãƒ­ã‚° */}
      <BattleLog />
    </div>
  );
};
```

#### HPBar.tsx

```typescript
import React from 'react';

interface HPBarProps {
  current: number;
  max: number;
  showNumbers?: boolean;
}

export const HPBar: React.FC<HPBarProps> = ({ current, max, showNumbers = false }) => {
  const percentage = (current / max) * 100;
  
  const getBarColor = () => {
    if (percentage > 50) return 'bg-green-500';
    if (percentage > 20) return 'bg-yellow-500';
    return 'bg-red-500';
  };
  
  return (
    <div className="hp-bar">
      <div className="flex justify-between mb-1">
        <span className="text-sm font-semibold">HP</span>
        {showNumbers && (
          <span className="text-sm">{current} / {max}</span>
        )}
      </div>
      <div className="w-full bg-gray-300 rounded-full h-4 overflow-hidden">
        <div
          className={`h-full transition-all duration-500 ${getBarColor()}`}
          style={{ width: `${percentage}%` }}
        />
      </div>
    </div>
  );
};
```

#### MoveSelector.tsx

```typescript
import React from 'react';
import { Move } from '@/types/pokemon';

interface MoveSelectorProps {
  moves: Move[];
  onMoveSelect: (moveId: number) => void;
  disabled: boolean;
}

export const MoveSelector: React.FC<MoveSelectorProps> = ({
  moves,
  onMoveSelect,
  disabled
}) => {
  return (
    <div className="grid grid-cols-2 gap-2 p-4">
      {moves.map((move) => (
        <button
          key={move.moveId}
          onClick={() => onMoveSelect(move.moveId)}
          disabled={disabled}
          className={`
            p-4 rounded-lg border-2 text-left
            ${disabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-100'}
            ${getTypeColor(move.type)}
          `}
        >
          <div className="font-bold">{move.name}</div>
          <div className="text-sm">
            <span className="mr-2">å¨åŠ›: {move.power}</span>
            <span>PP: {move.pp}</span>
          </div>
          <div className="text-xs mt-1 opacity-75">
            {move.type} / {move.damageClass}
          </div>
        </button>
      ))}
    </div>
  );
};

const getTypeColor = (type: string): string => {
  const colors: Record<string, string> = {
    Normal: 'border-gray-400',
    Fire: 'border-red-500',
    Water: 'border-blue-500',
    Electric: 'border-yellow-400',
    Grass: 'border-green-500',
    Ice: 'border-cyan-300',
    Fighting: 'border-orange-600',
    Poison: 'border-purple-500',
    Ground: 'border-yellow-700',
    Flying: 'border-indigo-300',
    Psychic: 'border-pink-500',
    Bug: 'border-lime-500',
    Rock: 'border-yellow-800',
    Ghost: 'border-purple-700',
    Dragon: 'border-indigo-600',
    Dark: 'border-gray-700',
    Steel: 'border-gray-500',
    Fairy: 'border-pink-300'
  };
  
  return colors[type] || 'border-gray-400';
};
```

---

## SignalRï¼ˆWebSocketï¼‰ã«ã‚ˆã‚‹å¯¾æˆ¦ãƒ•ãƒ­ãƒ¼

### å®Œå…¨ãªãƒãƒˆãƒ«ãƒ•ãƒ­ãƒ¼å›³

```
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1                SignalR Hub               ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2
    â”‚                          â”‚                          â”‚
    â”œâ”€â”€â”€ InitBattle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚                          â”œâ”€â”€â”€ ReceiveBattleState â”€â”€>â”‚
    â”‚<â”€â”€â”€ ReceiveBattleState â”€â”€â”¤                          â”‚
    â”‚                          â”‚                          â”‚
    â”œâ”€â”€â”€ SubmitAction â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚     (æ”»æ’ƒé¸æŠ)            â”‚<â”€â”€â”€ SubmitAction â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                          â”‚     (æ”»æ’ƒé¸æŠ)            â”‚
    â”‚                   [ä¸¡æ–¹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æƒã†]             â”‚
    â”‚                          â”‚                          â”‚
    â”‚                   [ProcessTurnAsyncå®Ÿè¡Œ]            â”‚
    â”‚                   [ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ãƒ»HPæ›´æ–°]            â”‚
    â”‚                   [å‹æ•—åˆ¤å®š]                        â”‚
    â”‚                          â”‚                          â”‚
    â”‚<â”€ ReceiveTurnResult â”€â”€â”€â”€â”€â”¼â”€ ReceiveTurnResult â”€â”€â”€â”€â”€>â”‚
    â”‚    (çµæœã‚’è¡¨ç¤º)           â”‚    (çµæœã‚’è¡¨ç¤º)          â”‚
    â”‚    (HPãƒãƒ¼æ›´æ–°)           â”‚    (HPãƒãƒ¼æ›´æ–°)          â”‚
    â”‚    (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)        â”‚    (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)       â”‚
    â”‚                          â”‚                          â”‚
    â””â”€â”€â”€â”€â”€[æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸]â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€[æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸]â”€â”€â”€â”€â”€â”˜
```

### è©³ç´°ãªå®Ÿè£…ãƒ•ãƒ­ãƒ¼

#### 1. ãƒãƒˆãƒ«é–‹å§‹

```typescript
// 1. ãƒãƒˆãƒ«ä½œæˆ
const response = await axios.post('/api/Battle/create', {
  player1Id: 'player1',
  player2Id: 'player2'
});

const battleId = response.data.battleId;

// 2. SignalRæ¥ç¶š
const connection = await signalRService.connect(token);

// 3. ãƒãƒˆãƒ«åˆæœŸåŒ–
await connection.invoke('InitBattle', battleId);
```

#### 2. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡

```typescript
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŠ€ã‚’é¸æŠ
const action: PlayerAction = {
  playerId: currentPlayerId,
  actionType: ActionType.Attack,
  moveId: selectedMoveId
};

// SignalRã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡
await connection.invoke('SubmitAction', battleId, action);

// å¾…æ©ŸçŠ¶æ…‹è¡¨ç¤º
setWaitingForOpponent(true);
```

#### 3. ã‚¿ãƒ¼ãƒ³çµæœå—ä¿¡

```typescript
connection.on('ReceiveTurnResult', async (result: ProcessResult) => {
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
  for (const actionResult of result.actionResults) {
    if (actionResult.moveResult) {
      // 1. æŠ€åè¡¨ç¤º
      await showMoveAnimation(actionResult.moveResult.moveId);
      await delay(500);
      
      // 2. ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      await animateDamage(
        actionResult.moveResult.targetId,
        actionResult.moveResult.damage
      );
      
      // 3. HPæ¸›å°‘ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      await animateHpDecrease(
        actionResult.moveResult.targetId,
        actionResult.moveResult.damage
      );
      
      // 4. ã‚¿ã‚¤ãƒ—ç›¸æ€§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      if (actionResult.moveResult.hitContext) {
        const effectiveness = actionResult.moveResult.hitContext.typeEffectiveness;
        if (effectiveness > 1) {
          await showMessage('åŠ¹æœã¯æŠœç¾¤ã ï¼');
        } else if (effectiveness < 1) {
          await showMessage('åŠ¹æœã¯ã„ã¾ã²ã¨ã¤ã®ã‚ˆã†ã ...');
        }
        
        if (actionResult.moveResult.hitContext.isCritical) {
          await showMessage('æ€¥æ‰€ã«å½“ãŸã£ãŸï¼');
        }
      }
      
      await delay(1000);
    }
  }
  
  // ãƒãƒˆãƒ«çµ‚äº†ãƒã‚§ãƒƒã‚¯
  if (result.isBattleEnd) {
    const isWinner = result.winnerId === currentPlayerId;
    await showBattleEndScreen(isWinner);
  }
  
  // æ¬¡ã®ã‚¿ãƒ¼ãƒ³æº–å‚™
  setWaitingForOpponent(false);
});
```

---

## çŠ¶æ…‹ç®¡ç†ã®è¨­è¨ˆ

### çŠ¶æ…‹ã®ç¨®é¡

1. **ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹** (Zustand/Redux)
   - `battleState`: ç¾åœ¨ã®ãƒãƒˆãƒ«çŠ¶æ…‹
   - `authState`: èªè¨¼æƒ…å ±
   - `playerData`: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±

2. **ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹** (useState)
   - `selectedMove`: é¸æŠä¸­ã®æŠ€
   - `isAnimating`: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ãƒ•ãƒ©ã‚°
   - `battleLog`: ãƒãƒˆãƒ«ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

3. **ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹** (React Queryæ¨å¥¨)
   - ãƒãƒˆãƒ«ä¸€è¦§
   - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‘ãƒ¼ãƒ†ã‚£

### çŠ¶æ…‹åŒæœŸæˆ¦ç•¥

```typescript
// ãƒãƒˆãƒ«çŠ¶æ…‹ã®åŒæœŸ
useEffect(() => {
  if (turnResult) {
    // ã‚¿ãƒ¼ãƒ³çµæœã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
    updateLocalBattleState(turnResult);
  }
}, [turnResult]);

const updateLocalBattleState = (result: ProcessResult) => {
  result.actionResults.forEach(action => {
    if (action.moveResult) {
      // HPæ›´æ–°
      updatePokemonHp(
        action.moveResult.targetId,
        action.moveResult.damage
      );
    }
    
    if (action.switchResult) {
      // ãƒã‚±ãƒ¢ãƒ³äº¤ä»£
      switchActivePokemon(
        action.switchResult.currentPokemonId,
        action.switchResult.nextPokemonId
      );
    }
  });
};
```

---

## UI/UXã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

#### ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
const animateDamage = async (targetId: string, damage: number) => {
  const element = document.getElementById(`pokemon-${targetId}`);
  if (!element) return;
  
  // ãƒ€ãƒ¡ãƒ¼ã‚¸æ•°å€¤è¡¨ç¤º
  const damageText = document.createElement('div');
  damageText.className = 'damage-text';
  damageText.textContent = `-${damage}`;
  element.appendChild(damageText);
  
  // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  element.classList.add('damage-flash');
  await delay(100);
  element.classList.remove('damage-flash');
  
  // ã‚·ã‚§ã‚¤ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  element.classList.add('shake');
  await delay(500);
  element.classList.remove('shake');
  
  // ãƒ€ãƒ¡ãƒ¼ã‚¸æ•°å€¤ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
  damageText.classList.add('fade-out');
  await delay(500);
  damageText.remove();
};
```

**CSS**:

```css
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

.shake {
  animation: shake 0.5s ease-in-out;
}

.damage-flash {
  filter: brightness(2) saturate(0);
}

.damage-text {
  position: absolute;
  font-size: 2rem;
  font-weight: bold;
  color: #ff4444;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  animation: float-up 1s ease-out;
}

@keyframes float-up {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-50px);
  }
}
```

#### HPæ¸›å°‘ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
const animateHpDecrease = async (pokemonId: string, damage: number) => {
  const pokemon = getPokemonById(pokemonId);
  if (!pokemon) return;
  
  const startHp = pokemon.currentHp;
  const endHp = Math.max(0, startHp - damage);
  const duration = 1000; // 1ç§’
  const steps = 60; // 60ãƒ•ãƒ¬ãƒ¼ãƒ 
  const decrement = (startHp - endHp) / steps;
  
  for (let i = 0; i < steps; i++) {
    const currentHp = Math.max(endHp, startHp - (decrement * i));
    updatePokemonHpDisplay(pokemonId, currentHp);
    await delay(duration / steps);
  }
  
  updatePokemonHpDisplay(pokemonId, endHp);
};
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

```tsx
// ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
<div className="battle-field grid grid-cols-1 md:grid-cols-2 gap-4">
  <div className="pokemon-area">
    {/* ãƒã‚±ãƒ¢ãƒ³è¡¨ç¤º */}
  </div>
  <div className="command-area">
    <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
      {/* æŠ€ãƒœã‚¿ãƒ³ */}
    </div>
  </div>
</div>
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// SignalRæ¥ç¶šã‚¨ãƒ©ãƒ¼
connection.onclose((error) => {
  console.error('Connection closed:', error);
  showNotification('æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸã€‚å†æ¥ç¶šã—ã¦ã„ã¾ã™...');
  
  // è‡ªå‹•å†æ¥ç¶š
  setTimeout(() => {
    connection.start();
  }, 5000);
});

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡ã‚¨ãƒ©ãƒ¼
try {
  await connection.invoke('SubmitAction', battleId, action);
} catch (error) {
  console.error('Failed to submit action:', error);
  showNotification('ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
  setWaitingForOpponent(false);
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```typescript
// ãƒ¡ãƒ¢åŒ–
const MoveButton = React.memo(({ move, onSelect }) => {
  return (
    <button onClick={() => onSelect(move.moveId)}>
      {move.name}
    </button>
  );
});

// ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆãƒãƒˆãƒ«ãƒ­ã‚°ï¼‰
import { FixedSizeList } from 'react-window';

const BattleLog = ({ logs }) => {
  return (
    <FixedSizeList
      height={300}
      itemCount={logs.length}
      itemSize={30}
      width="100%"
    >
      {({ index, style }) => (
        <div style={style}>{logs[index]}</div>
      )}
    </FixedSizeList>
  );
};
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

#### 1. SignalRæ¥ç¶šãŒç¢ºç«‹ã§ããªã„

**åŸå› **: CORSè¨­å®šã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ä¸æ­£

**è§£æ±ºç­–**:
```csharp
// Program.cs
builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(policy =>
    {
        policy.WithOrigins("http://localhost:3000")
              .AllowAnyHeader()
              .AllowAnyMethod()
              .AllowCredentials();
    });
});
```

#### 2. ã‚¿ãƒ¼ãƒ³çµæœãŒå—ä¿¡ã§ããªã„

**åŸå› **: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®ç™»éŒ²ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**è§£æ±ºç­–**:
```typescript
// connection.start() ã®å‰ã«ãƒãƒ³ãƒ‰ãƒ©ã‚’ç™»éŒ²
connection.on('ReceiveTurnResult', handleTurnResult);
await connection.start();
await connection.invoke('InitBattle', battleId);
```

#### 3. HPæ›´æ–°ãŒåæ˜ ã•ã‚Œãªã„

**åŸå› **: çŠ¶æ…‹ã®ä¸å¤‰æ€§é•å

**è§£æ±ºç­–**:
```typescript
// âŒ é–“é•ã„
state.battleState.player1.party[0].currentHp -= damage;

// âœ… æ­£ã—ã„
setBattleState({
  ...state.battleState,
  player1: {
    ...state.battleState.player1,
    party: state.battleState.player1.party.map((p, i) =>
      i === 0 ? { ...p, currentHp: p.currentHp - damage } : p
    )
  }
});
```

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å¿…é ˆæ©Ÿèƒ½

- [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ»JWTä¿å­˜ï¼‰
- [ ] ãƒãƒˆãƒ«ä½œæˆï¼ˆå¯¾äººãƒ»CPUï¼‰
- [ ] SignalRæ¥ç¶šç¢ºç«‹
- [ ] ãƒãƒˆãƒ«åˆæœŸåŒ–ï¼ˆInitBattleï¼‰
- [ ] æŠ€é¸æŠUI
- [ ] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡ï¼ˆSubmitActionï¼‰
- [ ] ã‚¿ãƒ¼ãƒ³çµæœå—ä¿¡ï¼ˆReceiveTurnResultï¼‰
- [ ] HPè¡¨ç¤ºãƒ»æ›´æ–°
- [ ] ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] ãƒãƒˆãƒ«ãƒ­ã‚°è¡¨ç¤º
- [ ] å‹æ•—åˆ¤å®šãƒ»çµæœç”»é¢

### è¿½åŠ æ©Ÿèƒ½

- [ ] ãƒã‚±ãƒ¢ãƒ³äº¤ä»£æ©Ÿèƒ½
- [ ] ã‚¿ã‚¤ãƒ—ç›¸æ€§è¡¨ç¤º
- [ ] çŠ¶æ…‹ç•°å¸¸è¡¨ç¤ºï¼ˆéº»ç—ºãƒ»ç«å‚·ç­‰ï¼‰
- [ ] èƒ½åŠ›ãƒ©ãƒ³ã‚¯è¡¨ç¤º
- [ ] æ€¥æ‰€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- [ ] ãƒãƒˆãƒ«å±¥æ­´
- [ ] ãƒªãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½
- [ ] ã‚µã‚¦ãƒ³ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- [ ] BGM
- [ ] ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ASP.NET Core SignalR](https://learn.microsoft.com/ja-jp/aspnet/core/signalr/introduction)
- [SignalR JavaScript Client](https://learn.microsoft.com/ja-jp/aspnet/core/signalr/javascript-client)
- [Next.js Documentation](https://nextjs.org/docs)
- [React Documentation](https://react.dev/)
- [Zustand](https://github.com/pmndrs/zustand)

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒªã‚½ãƒ¼ã‚¹

- [ãƒã‚±ãƒ¢ãƒ³å¯¾æˆ¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ Pokemon Showdown](https://github.com/smogon/pokemon-showdown)
- [PokÃ©API](https://pokeapi.co/)

---

## ã¾ã¨ã‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®BattleServiceã¨SignalR Hubã‚’æ´»ç”¨ã—ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒˆãƒ«ã‚’å®Ÿè£…ã™ã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã—ãŸã€‚

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**:

1. **SignalRã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡**: ä¸¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åŒæœŸã—ã€ã‚¿ãƒ¼ãƒ³çµæœã‚’å³åº§ã«é…ä¿¡
2. **çŠ¶æ…‹ç®¡ç†ã®é©åˆ‡ãªè¨­è¨ˆ**: BattleStateã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§æ­£ç¢ºã«ç®¡ç†ã—ã€UIã«åæ˜ 
3. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨UX**: ãƒ€ãƒ¡ãƒ¼ã‚¸ã€HPæ¸›å°‘ã€ã‚¿ã‚¤ãƒ—ç›¸æ€§ãªã©ã‚’è¦–è¦šçš„ã«è¡¨ç¾
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ¥ç¶šåˆ‡æ–­ã€å†æ¥ç¶šã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—ã¸ã®å¯¾å¿œ

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ã™ã§ã«å®Œå…¨ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã£ã¦SignalRã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã€å®Œå…¨ãªãƒãƒˆãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒå‹•ä½œã—ã¾ã™ã€‚

é ‘å¼µã£ã¦ãã ã•ã„ï¼ğŸ”¥
