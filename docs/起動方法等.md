# 各種起動方法

## データベース起動

```bash
# 初回のみコンテナのイメージを取得
docker run -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=Your_Password123!" -p 1433:1433 --name sql_server_dev -d mcr.microsoft.com/mssql/server:2022-latest
# 2回目以降はコンテナを起動
docker start sql_server_dev
# コンテナの停止
docker stop sql_server_dev
```

## マイグレーション

```bash
dotnet ef database drop --force
# マイグレーションのリセット(うまくいかない場合は手動でMigrationsフォルダを削除)
dotnet ef migrations remove
# 初回は以下を実行
dotnet ef migrations add InitialCreate
dotnet ef database update
```

## バックエンドサーバ起動

```bash
cd /server
# .NET SDKのバージョン確認
dotnet --info 
dotnet restore ./server
dotnet build ./server
# サーバ起動
dotnet run 
# APIのエンドポイントは http://localhost:5000/swagger/index.html で確認可能.
```


## バッチ処理

```bash
# (重要)テスト時は3件とかでいいよ！！！！！
# ポケモン種族データのシード（第1世代: 1-151）
dotnet run --seed --species --start 1 --end 151

# 技データのシード（第1世代の技: 1-165）
dotnet run --seed --moves --start 1 --end 165
```

```bash
# データ件数を確認
docker exec -it sql_server_dev /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'Your_Password123!' -d PokeCloneDb -C -Q "SELECT COUNT(*) AS TotalCount FROM PokemonSpecies"

# Movesテーブルの件数確認
docker exec -it sql_server_dev /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'Your_Password123!' -d PokeCloneDb -C -Q "SELECT COUNT(*) AS TotalCount FROM Moves"

# 最初の5件を確認（PokemonSpecies）
docker exec -it sql_server_dev /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'Your_Password123!' -d PokeCloneDb -C -Q "SELECT TOP 5 * FROM PokemonSpecies ORDER BY PokemonSpeciesId"

# 最初の5件を確認（Moves）
docker exec -it sql_server_dev /opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'Your_Password123!' -d PokeCloneDb -C -Q "SELECT TOP 5 * FROM Moves ORDER BY MoveId"
```

## 起動処理まとめ

```bash
docker start sql_server_dev
dotnet ef database update --project server --startup-project server
dotnet run --project server -- --seed --species --start 1 --end 3
dotnet run --project server -- --seed --moves --start 1 --end 3
dotnet run --project server
```
